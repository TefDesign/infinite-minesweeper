(()=>{var Me=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ye=Me(()=>{const V=Math.sqrt(3)*35,j=70,Se=.28,Ee=.1,A=6,ue=2,se="infinite_minesweeper_save_v3.9_hex",ae=["rgba(0,0,0,0)","#779ECB","#77DD77","#FF6961","#B19CD9","#FFB347","#CB99C9"],Ie=.4,Ae=3,b={hidden:"#B9D1DC",hiddenHover:"#CDE2EC",hiddenUnreachable:"#98B0BB",revealedSafe:"#FEFDF5",revealedMine:"#FFB7B2",flag:"#444",token:"#F4D03F",zoneLockedOverlay:"rgba(50, 50, 50, 0.4)",zoneBorder:"rgba(255, 255, 255, 0.4)",unlockButton:"#64B5F6",unlockButtonHover:"#42A5F5",background:"#F0F4F8"},h=document.getElementById("game-canvas"),o=h.getContext("2d"),S=new Map,_=new Map,U=new Set,X=[];let R=10,W=0,C=0,F=0,Z=!1,K=Math.random(),y=window.innerWidth/2,x=window.innerHeight/2,a=3,L=!1,ee=0,te=0,p=0,M=0,B={Space:!1};const he=(t,e,n=0)=>{let s=Math.sin(t*12.9898+e*78.233+n+K)*43758.5453123;return s-Math.floor(s)},O=(t,e)=>`${t},${e}`,Re=t=>t.split(",").map(Number),ge=(t,e)=>`${t},${e}`;function Q(t,e){const n=35*(Math.sqrt(3)*t+Math.sqrt(3)/2*e),s=35*(3/2*e);return{x:n,y:s}}function le(t,e){const n=(Math.sqrt(3)/3*t-.3333333333333333*e)/35,s=2/3*e/35;return me(n,s)}function ce(t,e,n,s){return(Math.abs(t-n)+Math.abs(e-s)+Math.abs(t+e-(n+s)))/2}function me(t,e){let n=-t-e,s=Math.round(t),l=Math.round(e),c=Math.round(n);const i=Math.abs(s-t),f=Math.abs(l-e),g=Math.abs(c-n);return i>f&&i>g?s=-l-c:f>g&&(l=-s-c),{q:s,r:l}}function we(t){const e=[];for(let n=0;n<6;n++){const s=60*n-30,l=Math.PI/180*s;e.push({x:t.x+35*Math.cos(l),y:t.y+35*Math.sin(l)})}return e}function ye(t,e,n){return he(t,e,n)}const He=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function N(t,e){return He.map(n=>({q:t+n.q,r:e+n.r}))}const I=A;function Te(t,e){return me(t/I,e/I)}function P(t,e){const n=Te(t,e);return{zq:n.q,zr:n.r}}function H(t,e){const n=ge(t,e);if(!_.has(n)){const l=8+(Math.abs(t)+Math.abs(e))*2+he(t,e,99)*5,c=Math.max(10,l);_.set(n,{locked:!1,unlockCost:Math.floor(c),zq:t,zr:e})}return _.get(n)}function _e(t,e){const n=H(t,e);n.locked||(n.locked=!0)}function Be(t,e){const n=H(t,e);return n.locked&&R>=n.unlockCost?(R-=n.unlockCost,n.locked=!1,De(t,e),Ce(t,e),D(),!0):!1}function De(t,e){const n=t*A,s=e*A,l=A+2;for(let c=s-l;c<=s+l;c++)for(let i=n-l;i<=n+l;i++){const f=P(i,c);if(f.zq===t&&f.zr===e){const g=O(i,c),d=S.get(g);d&&d.flagged&&(q(i,c)||(d.flagged=!1,d.revealed=!0,d.count=G(i,c),C--,F++))}}}function Ce(t,e){const n=t*I,s=e*I,l=Q(n,s),c=document.createElement("div");c.className="unlock-ripple",document.body.appendChild(c);const i=l.x*a+y,f=l.y*a+x;c.style.left=i+"px",c.style.top=f+"px",setTimeout(()=>c.remove(),600)}function q(t,e){return Math.abs(t)<=1&&Math.abs(e)<=1?!1:ye(t,e,1)<Se}function ne(t,e){return Math.abs(t)<=1&&Math.abs(e)<=1||q(t,e)?!1:ye(t,e,2)<Ee}function G(t,e){let n=0;return N(t,e).forEach(s=>{q(s.q,s.r)&&n++}),n}function ie(t,e){const n=O(t,e);return S.has(n)||S.set(n,{revealed:!1,flagged:!1,hasToken:ne(t,e)}),S.get(n)}function oe(t,e){if(F===0)return Math.abs(t)<=1&&Math.abs(e)<=1;const n=N(t,e);for(let s of n){const l=S.get(O(s.q,s.r));if(l&&l.revealed)return!0;for(let c of N(s.q,s.r)){const i=S.get(O(c.q,c.r));if(i&&i.revealed)return!0}}return!1}function Xe(t,e){const{zq:n,zr:s}=P(t,e);if(!H(n,s).locked)return!1;const c=n*A,i=s*A;return ce(t,e,c,i)<=ue}function xe(t,e){if(Xe(t,e))return;const n=ie(t,e);if(n.revealed||n.flagged)return;const{zq:s,zr:l}=P(t,e),c=s*A,i=l*A,f=ce(t,e,c,i);if(q(t,e)){n.revealed=!0,n.isMine=!0,_e(s,l),Fe(),D();return}n.revealed=!0,n.isMine=!1,F++,n.count=G(t,e),W+=10,n.hasToken&&(n.hasToken=!1,R++,Pe(t,e)),D(),n.count===0&&N(t,e).forEach(g=>ze(g.q,g.r))}function ze(t,e){X.push({q:t,r:e}),Z||ve()}function ve(){if(X.length===0){Z=!1;return}Z=!0;let t=0;for(;X.length>0&&t<8;){const{q:e,r:n}=X.shift(),s=ie(e,n);!s.revealed&&!s.flagged&&xe(e,n),t++}X.length>0?requestAnimationFrame(ve):Z=!1}function Le(t,e){const{zq:n,zr:s}=P(t,e);if(H(n,s).locked)return;const l=ie(t,e);l.revealed||(l.flagged=!l.flagged,C+=l.flagged?1:-1,D())}function be(){K=Math.random(),S.clear(),_.clear(),U.clear(),R=10,W=0,C=0,F=0,y=h.width/2,x=h.height/2,a=1.5,localStorage.removeItem(se),D(),Y()}function ke(){h.width=window.innerWidth,h.height=window.innerHeight,Y()}function Y(){o.clearRect(0,0,h.width,h.height),o.save(),o.translate(y,x),o.scale(a,a),U.clear();const t=-y/a,e=-x/a,n=(h.width-y)/a,s=(h.height-x)/a,l=Math.floor(e/(1.5*35))-2,c=Math.ceil(s/(1.5*35))+2,i=Math.ceil((n-t)/V)+2,f=(t+n)/2,g=Math.round(f/V),d=le((t+n)/2,(e+s)/2),m=Math.ceil((n-t)/V/2)+2,v=Math.ceil((s-e)/j/2)+2;for(let u=d.r-v;u<=d.r+v;u++){let r=Math.floor(u/2);for(let k=d.q-m-r;k<=d.q+m-r+2;k++){const E=u*1.5*35;if(E<e-j||E>s+j)continue;const T=Math.floor(t/(35*Math.sqrt(3))-u/2)-1,$=Math.ceil(n/(35*Math.sqrt(3))-u/2)+1;for(let J=T;J<=$;J++)Oe(J,u)}}o.restore(),Ue(),requestAnimationFrame(Y)}function Oe(t,e){const n=Q(t,e),s=O(t,e),l=S.get(s)||{revealed:!1,flagged:!1,hasToken:ne(t,e)},{zq:c,zr:i}=P(t,e),f=H(c,i),g=ce(t,e,c*I,i*I),d=f.locked&&g<=ue,m=ge(c,i),v=oe(t,e);d&&U.add(m);const u=we(n);o.beginPath(),o.moveTo(u[0].x,u[0].y);for(let r=1;r<6;r++)o.lineTo(u[r].x,u[r].y);if(o.closePath(),l.revealed)o.fillStyle=l.isMine?b.revealedMine:b.revealedSafe;else if(!v)o.fillStyle=b.hiddenUnreachable;else{const r=le((p-y)/a,(M-x)/a);o.fillStyle=r.q===t&&r.r===e?b.hiddenHover:b.hidden}if(o.fill(),d?(o.strokeStyle="rgba(255, 255, 255, 0.8)",o.lineWidth=2):(o.strokeStyle="rgba(255,255,255,0.2)",o.lineWidth=1),o.stroke(),d&&w!==m){o.fillStyle=b.zoneLockedOverlay,o.fill();return}if(d&&w===m&&!l.revealed){if(o.save(),o.globalAlpha=.5,q(t,e))o.fillStyle="#444",o.beginPath(),o.arc(n.x,n.y,35/2.5,0,Math.PI*2),o.fill();else{const r=G(t,e);r>0&&(o.fillStyle=ae[r]||"#000",o.font="bold 20px Outfit",o.textAlign="center",o.textBaseline="middle",o.fillText(r,n.x,n.y+2))}ne(t,e)&&(o.fillStyle=b.token,o.font="20px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText("\u{1F48E}",n.x,n.y+2)),o.restore()}l.revealed?l.isMine?(o.fillStyle="#444",o.beginPath(),o.arc(n.x,n.y,35/2.5,0,Math.PI*2),o.fill()):l.count>0&&(o.fillStyle=ae[l.count]||"#000",o.font="bold 20px Outfit",o.textAlign="center",o.textBaseline="middle",o.fillText(l.count,n.x,n.y+2)):l.flagged?(o.fillStyle=b.flag,o.font="24px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText("\u{1F6A9}",n.x,n.y+2)):l.hasToken&&oe(t,e)?(o.fillStyle=b.token,o.font="20px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText("\u{1F48E}",n.x,n.y+2)):l.hasToken&&!f.locked&&(o.fillStyle=b.token,o.globalAlpha=.5,o.font="20px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText("\u{1F48E}",n.x,n.y+2),o.globalAlpha=1)}let w=null;function Ue(){for(let t of U){if(w===t)continue;const[e,n]=t.split(",").map(Number),s=H(e,n),l=e*I,c=n*I,i=Q(l,c),f=i.x*a+y,g=i.y*a+x,d=120,m=40,v=f-d/2,u=g-m/2,r=30,k=v+d+10,E=u+(m-r)/2,T=p>=v&&p<=v+d&&M>=u&&M<=u+m,$=p>=k&&p<=k+r&&M>=E&&M<=E+r;o.strokeStyle="white",o.lineWidth=2,o.fillStyle=T?b.unlockButtonHover:b.unlockButton,o.beginPath(),o.roundRect(v,u,d,m,10),o.fill(),o.stroke(),o.fillStyle="white",o.font="bold 16px Outfit",o.textAlign="center",o.textBaseline="alphabetic",o.fillText(`\u{1F512} ${s.unlockCost} \u{1F48E}`,f,g+5),o.fillStyle=$?"#AAA":"#888",o.beginPath(),o.arc(k+r/2,E+r/2,r/2,0,Math.PI*2),o.fill(),o.stroke(),o.fillStyle="white",o.font="16px Arial",o.fillText("\u{1F441}\uFE0F",k+r/2,E+r/2+5)}}function Fe(){document.body.classList.add("shake"),setTimeout(()=>document.body.classList.remove("shake"),500)}function Pe(t,e){const n=document.createElement("div");n.innerText="\u{1F48E}",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.fontSize="2rem",n.style.pointerEvents="none",n.style.transition="all 1s ease-out",n.style.zIndex="999",document.body.appendChild(n),requestAnimationFrame(()=>{n.style.transform="translateY(-100px) scale(1.5)",n.style.opacity="0"}),setTimeout(()=>n.remove(),1e3)}function D(){const t=document.getElementById("score-count");t&&(t.innerText=R);const e=document.getElementById("flag-count");e&&(e.innerText=C)}window.addEventListener("resize",ke);const z=document.getElementById("pause-modal"),fe=document.getElementById("btn-close-modal"),de=document.getElementById("btn-restart");function re(t){t?(z.classList.remove("hidden"),z.classList.add("visible")):(z.classList.remove("visible"),z.classList.add("hidden"))}fe&&fe.addEventListener("click",()=>re(!1));de&&de.addEventListener("click",()=>{re(!1),be()});window.addEventListener("keydown",t=>{if(t.code==="Space"&&(B.Space=!0,h.style.cursor="grab"),t.code==="Escape"){const e=z.classList.contains("visible");re(!e)}});window.addEventListener("keyup",t=>{t.code==="Space"&&(B.Space=!1,h.style.cursor="crosshair",L=!1)});h.addEventListener("wheel",t=>{t.preventDefault();const e=t.deltaY>0?.9:1.1,n=Math.min(Math.max(a*e,Ie),Ae),s=h.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top,i=(l-y)/a,f=(c-x)/a;y=l-i*n,x=c-f*n,a=n},{passive:!1});h.addEventListener("mousemove",t=>{const e=h.getBoundingClientRect();p=t.clientX-e.left,M=t.clientY-e.top,B.Space&&L?(y+=t.clientX-ee,x+=t.clientY-te,ee=t.clientX,te=t.clientY):B.Space});h.addEventListener("mousedown",t=>{if(B.Space){L=!0,ee=t.clientX,te=t.clientY,h.style.cursor="grabbing";return}for(let n of U){if(w===n)continue;const[s,l]=n.split(",").map(Number),c=s*I,i=l*I,f=Q(c,i),g=f.x*a+y,d=f.y*a+x,m=120,v=40,u=g-m/2,r=d-v/2,k=30,E=u+m+10,T=r+(v-k)/2;if(p>=u&&p<=u+m&&M>=r&&M<=r+v){Be(s,l);return}if(p>=E&&p<=E+k&&M>=T&&M<=T+k){w=n,Y();return}}const e=le((p-y)/a,(M-x)/a);oe(e.q,e.r)&&(t.button===0?xe(e.q,e.r):t.button===2&&Le(e.q,e.r))});h.addEventListener("mouseup",()=>{w&&(w=null,Y()),L&&(L=!1,h.style.cursor=B.Space?"grab":"crosshair")});h.addEventListener("contextmenu",t=>t.preventDefault());function pe(){const t=[];for(let[s,l]of S)if(l.revealed||l.flagged||l.hasOwnProperty("hasToken")&&!l.hasToken){let c={};l.revealed&&(c.r=1),l.flagged&&(c.f=1),l.hasToken!==void 0&&(c.t=l.hasToken?1:0),l.isMine&&(c.m=1),t.push([s,c])}const e=[];for(let[s,l]of _)l.locked&&e.push(s);const n={tokens:R,score:W,flagCount:C,seed:K,cam:{x:y,y:x,zoom:a},grid:t,zones:e};try{localStorage.setItem(se,JSON.stringify(n))}catch{}}function qe(){const t=localStorage.getItem(se);if(!t)return!1;try{const e=JSON.parse(t);return R=e.tokens||10,W=e.score||0,C=e.flagCount||0,K=e.seed||Math.random(),e.cam&&(y=e.cam.x,x=e.cam.y,a=e.cam.zoom||1),S.clear(),e.grid&&e.grid.forEach(([n,s])=>{const l={revealed:!!s.r,flagged:!!s.f,isMine:!!s.m,hasToken:s.t!==void 0?!!s.t:void 0};if(l.revealed&&!l.isMine){const[c,i]=Re(n);l.count=G(c,i),F++}S.set(n,l)}),_.clear(),e.zones&&e.zones.forEach(n=>{const s=n.split(",").map(Number);if(s.length===2){const[l,c]=s,i=H(l,c);i.locked=!0}}),!0}catch{return!1}}setInterval(pe,5e3);window.addEventListener("beforeunload",pe);ke();qe()||be();D()});Ye();})();
